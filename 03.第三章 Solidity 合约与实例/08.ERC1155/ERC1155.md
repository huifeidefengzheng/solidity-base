# 3.8 ERC1155

### ERC1155 教案：多代币标准与应用

#### 课程目标

- 了解 ERC1155 多代币标准的核心概念及其与 ERC20/ERC721 的区别
- 掌握如何在一个智能合约中管理同质化和非同质化代币
- 学习批量转账和节省 Gas 的优化技术
- 准备常见 ERC1155 面试问题及其解答

#### 课程结构

1. **ERC1155 概述：多代币标准**

   - **ERC1155 是什么？**
     - ERC1155 是一种支持同时管理多种类型代币（包括同质化代币和非同质化代币）的标准。它允许在一个智能合约中创建和管理多种代币类型，既可以是可替代的 ERC20 风格代币，也可以是独一无二的 ERC721 风格代币。
   - **与 ERC20/ERC721 的区别**：
     - **ERC20**：只支持同质化代币，适合代币化的货币或积分系统。
     - **ERC721**：只支持非同质化代币，适合艺术品、虚拟收藏品等。
     - **ERC1155**：同时支持同质化和非同质化代币，可以在同一个合约中管理多种类型代币。
2. **ERC1155 的核心功能**

   - **多代币管理**：ERC1155 支持同一合约中的多种代币，每个代币通过其唯一的 `id` 来区分。
   - **批量操作**：
     - `safeBatchTransferFrom()`：允许一次性转移多个代币，减少多次调用的成本，优化 Gas 消耗。
   - **代币的增发与销毁**：
     - `mint()`：为某个账户铸造一定数量的代币。
     - `burn()`：销毁账户中的代币。
   - **事件通知**：ERC1155 通过 `TransferSingle` 和 `TransferBatch` 事件通知代币的转移。
3. **ERC1155 的批量转账与 Gas 优化**

   - **批量转移**：ERC1155 的一大优势在于可以通过一次调用 `safeBatchTransferFrom()` 来转移多个代币，节省 Gas 费用，特别适用于游戏和 NFT 项目中需要频繁转移大量资产的场景。
   - **Gas 优化**：
     - ERC1155 在批量操作和多代币管理中显著节省了 Gas，避免了 ERC721 中逐个转移代币的高成本。
     - 示例代码展示批量转移如何节省 Gas。
4. **ERC1155 实现示例：多类型代币管理**

   - 以下是一个基于 OpenZeppelin 实现的 ERC1155 合约，展示如何在同一合约中管理多个类型的代币：

```typescript
pragma solidity ^0.5.0;
import "@openzeppelin/contracts/token/ERC1155/ERC1155.sol";
contract MyGameAssets is ERC1155 {
    uint256 public constant GOLD = 0;
    uint256 public constant SILVER = 1;
    uint256 public constant SWORD = 2;
    uint256 public constant SHIELD = 3;
    constructor() public ERC1155("https://mygame.io/api/token/{id}.json") {
        _mint(msg.sender, GOLD, 1000, "");
        _mint(msg.sender, SILVER, 5000, "");
        _mint(msg.sender, SWORD, 10, "");
        _mint(msg.sender, SHIELD, 5, "");
    }
}
```

**功能解释**：

- `GOLD` 和 `SILVER` 表示同质化代币，每种代币有不同的数量。
- `SWORD` 和 `SHIELD` 表示非同质化代币，每个代币都是独特的且数量有限。

1. **批量操作示例**
   - **批量转移多个代币**：

```typescript
function batchTransfer(address to, uint256[] memory ids, uint256[] memory amounts) public {
    safeBatchTransferFrom(msg.sender, to, ids, amounts, "");
}
```

- **批量转移的应用场景**：
  - 游戏中玩家可以一次性转移多个不同的物品，例如装备、道具等。
  - NFT 项目中可以批量转移多个收藏品。

1. **ERC1155 实际应用场景**

   - **游戏物品**：ERC1155 可以用来表示游戏中的物品，如金币（同质化）、武器（非同质化）等。
   - **虚拟世界中的土地**：可以通过 ERC1155 来表示不同类型的土地或建筑物，每种土地类型具有不同的属性和稀缺性。
   - **艺术品组合**：使用 ERC1155 来创建代表一个艺术家作品集的代币，其中每个代币代表该艺术家的不同作品。
2. **ERC1155 的优势与局限**

   - **优势**：
     - **多代币管理**：通过一个合约管理多种代币，降低部署和管理成本。
     - **批量操作**：可以同时转移多个代币，减少 Gas 消耗。
   - **局限**：
     - **复杂性增加**：相比 ERC20 和 ERC721，ERC1155 的逻辑更加复杂，开发和理解成本较高。
3. **ERC1155 常见面试问题与解答**

   - **1. ERC1155 与 ERC20/ERC721 的区别是什么？**
     - **回答**：ERC20 只支持同质化代币，ERC721 只支持非同质化代币，而 ERC1155 支持同一个合约中管理多种类型的代币，可以同时支持同质化和非同质化代币。ERC1155 还支持批量操作，显著节省 Gas。
   - **2. ERC1155 的 ****safeBatchTransferFrom()**** 有什么作用？**
     - **回答**：`safeBatchTransferFrom()` 允许在一次调用中转移多个不同类型的代币，减少了多个单独调用的 Gas 消耗，适合批量操作场景。
   - **3. ERC1155 是如何节省 Gas 的？**
     - **回答**：通过批量操作，ERC1155 允许一次性处理多个代币的转移、铸造和销毁操作，避免了像 ERC721 那样对每个代币进行单独操作时的高 Gas 成本。
   - **4. 如何在 ERC1155 中管理同质化和非同质化代币？**
     - **回答**：每个代币通过唯一的 `id` 来区分。同质化代币（如金币）可以有多个单位，非同质化代币（如独特的艺术品）则通常只有一个单位。通过管理 `id` 和其对应的数量来区分同质化与非同质化代币。

#### 作业

- 编写一个包含多种类型代币的 ERC1155 合约，包括同质化代币（如金币）和非同质化代币（如收藏品）。
- 实现批量转移函数 `safeBatchTransferFrom()`，并测试批量转移多个代币的功能。
